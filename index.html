<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ã¡ãã‚­ãƒ¥ãƒ³ã£ï¼å­¦åœ’ï½œæˆæ¥­æ–™ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <style>
    :root{--bg:#f8fafc;--card:#ffffff;--text:#0f172a;--muted:#64748b;--accent:#4f46e5;--border:#e5e7eb}
    *{box-sizing:border-box} html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
    .container{max-width:1000px;margin:20px auto;padding:16px}
    .title{font-size:24px;font-weight:800;margin-bottom:6px}
    .subtitle{font-size:13px;color:var(--muted);margin-bottom:8px}
    .notice{background:#ecfeff;border:1px solid #a5f3fc;color:#0e7490;padding:8px 12px;border-radius:10px;font-size:12px;margin-bottom:12px}
    .grid {
  display: grid;
  gap: 16px;
  grid-template-columns: 1fr; /* å¸¸ã«1åˆ— */
}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 2px 8px rgba(2,6,23,.04);padding:16px}
    .card { margin: 0; }
.card + .card { margin-top: 10px; }  /* â† å¥½ã¿ã§ 8ã€œ12px ã«èª¿æ•´å¯ */
    .section-title{font-weight:700;margin-bottom:12px}
    label{font-size:13px;color:var(--text);display:block;margin-bottom:6px}
    select,input[type="number"],input[type="text"]{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;font-size:14px;outline:none}
    input:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(79,70,229,.15)}
    .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .row + .row{margin-top:8px}
    .option{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:8px 0;border-top:1px dashed var(--border)}
    .option:first-of-type{border-top:none}
    .hint{font-size:12px;color:var(--muted)}
    .switch{display:flex;gap:8px;align-items:center}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer;font-weight:600}
    .btn.full{width:100%}
    .badge{display:inline-flex;align-items:center;gap:8px;background:#eef2ff;color:#3730a3;border-radius:999px;padding:4px 10px;font-size:12px;margin:4px 6px 0 0}
    .list{font-size:14px}
    .line{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
    .line.muted{color:var(--muted)}
    .line.total{font-size:20px;font-weight:800}
    .hr{border-top:1px solid var(--border);margin:10px 0}
    .note{font-size:12px;color:var(--muted)}
    details summary{cursor:pointer}
    .pill{display:inline-flex;gap:8px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;cursor:pointer;align-items:center;background:#fff}
    .pill input{margin:0}
    .wrap{display:flex;flex-wrap:wrap;gap:8px}
    .plays{display:flex;flex-wrap:wrap;gap:8px}
    .play{padding:6px 10px;border:1px dashed var(--border);border-radius:999px;font-size:13px;background:#fff}
    .tag{display:inline-flex;align-items:center;gap:6px;background:#f1f5f9;border:1px solid var(--border);padding:6px 10px;border-radius:999px}
    .tag input{margin:0}
    /* ã‚»ãƒƒãƒˆå…±é€šã®ä¸Šéƒ¨ãƒãƒŠãƒ¼ */
.options-banner{
  background:#fff7ed;           /* ã‚ªãƒ¬ãƒ³ã‚¸ç³»ã®è–„ã„èƒŒæ™¯ */
  border:1px solid #fed7aa;
  color:#9a3412;
  padding:10px 12px;
  border-radius:12px;
  font-size:13px;
  margin-bottom:12px;
  font-weight:700;
}

/* å„ã‚»ãƒƒãƒˆè¡Œã®å³å´ã«ä»˜ã‘ã‚‹å°ãƒãƒƒã‚¸ */
.save-badge{
  display:inline-block;
  padding:2px 8px;
  border-radius:999px;
  border:1px solid #fcd34d;
  background:#fef3c7;
  color:#b45309;
  font-size:11px;
  font-weight:700;
  white-space:nowrap;
}

#totalBar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #4f46e5;  /* æ¿ƒã„ç´«ï¼ˆãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼ã£ã½ã„ï¼‰ */
  color: white;
  font-size: 1.2rem;
  font-weight: bold;
  text-align: center;
  padding: 0.8rem;
  z-index: 10000;
}

/* ç”»é¢ä¸‹ã®å›ºå®šå¸¯ï¼ˆåˆè¨ˆï¼‹æ³¨æ„æ›¸ãï¼‰ */
#totalBar{
  position: fixed;
  bottom: 0;
  left: 0; right: 0;
  background: #63c3f3; /* æ¿ƒç´ºã«å¤‰æ›´ã—ãŸã„å ´åˆã¯ã“ã“ã‚’å¤‰ãˆã‚‹ */
  color: #fff;
  text-align: center;
  padding: 10px 12px;
  z-index: 10000;
  /* iPhoneã®ãƒ›ãƒ¼ãƒ ãƒãƒ¼å®‰å…¨é ˜åŸŸã‚‚è€ƒæ…® */
  padding-bottom: calc(10px + env(safe-area-inset-bottom));
  box-shadow: 0 -4px 12px rgba(0,0,0,.08);
}
#fixedTotal{ font-size: 20px; font-weight: 800; line-height: 1.2; }
#fixedNote{ font-size: 12px; opacity: .8; margin-top: 4px; }

/* å¸¯ã«éš ã‚Œãªã„ã‚ˆã†ä¸‹ä½™ç™½ã‚’ç¢ºä¿ï¼ˆãŠå¥½ã¿ã§å€¤èª¿æ•´ï¼‰ */
.container{ padding-bottom: 100px; }



  </style>



</head>
<body>
  <div class="container">
    <div class="title">ã¡ãã‚­ãƒ¥ãƒ³ã£ï¼å­¦åœ’ï½œæˆæ¥­æ–™ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
    <div class="subtitle">æˆæ¥­ã‚¿ã‚¤ãƒ—ãƒ»ã‚³ãƒ¼ã‚¹ãƒ»æŒ‡åãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ»å‰²å¼•ã‚’é¸ã¶ã¨è‡ªå‹•è¨ˆç®—ã—ã¾ã™ã€‚</div>
    <div class="notice">æœ¬ãƒšãƒ¼ã‚¸ã®æ–™é‡‘ã¯ <strong>å…¨ã¦ç¨è¾¼è¡¨ç¤º</strong> ã§ã™ã€‚</div>
    <div class="notice">ãƒ›ãƒ†ãƒ«ä»£ã¯åˆ¥é€” <strong>2,000å††ã€œ</strong> ã»ã©è¿½åŠ ã¨ãªã‚Šã¾ã™ã€‚â€»æœ¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®åˆè¨ˆã«ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>

      <div class="card">
        <div class="section-title">1. æˆæ¥­ã‚¿ã‚¤ãƒ—</div>

        <label>æˆæ¥­ã‚¿ã‚¤ãƒ—</label>
        <div class="wrap" id="classTypeWrap">
          <label class="pill"><input type="radio" name="ctype" value="basic" checked> åŸºæœ¬æˆæ¥­ï¼ˆå¥³å­ç”Ÿå¾’/å…ˆç”Ÿ 1äººï¼‰</label>
          <label class="pill"><input type="radio" name="ctype" value="duo"> åˆåŒæˆæ¥­ãƒ»3Pï¼ˆå¥³å­ç”Ÿå¾’/å…ˆç”Ÿ 2äººï¼‰</label>
        </div>

        <div style="margin-top:12px">
          <label>æˆæ¥­æ™‚é–“</label>
          <select id="course"></select>
          <div class="hint">â€» è¨˜è¼‰åˆ†æ•°ä»¥ä¸Šã®æˆæ¥­ã‚‚å¯¾å¿œå¯èƒ½ã§ã™ã€‚ã”äºˆç´„æ™‚ã«ã”ç›¸è«‡ãã ã•ã„ã€‚</div>
        </div>
      </div>

<div class="card">
  <div class="section-title">2. æŒ‡åãƒ»å…¥å­¦é‡‘</div>
  <div class="row">
    <div style="flex:1">
      <label>æŒ‡åç¨®åˆ¥</label>
      <select id="shimei">
        <option value="shimei">æŒ‡åï¼ˆÂ¥1,100ï¼‰</option>
        <option value="honshimei">æœ¬æŒ‡åï¼ˆä¼šã†ã®ãŒ2å›ç›®ã®å ´åˆï¼‰ï¼ˆÂ¥2,200ï¼‰</option>
      </select>
    </div>

    <div style="flex:1">
      <label>ç‰¹åˆ¥æŒ‡åæ–™</label>
      <select id="tokubetsu">
        <option value="0" selected>ãªã—ï¼ˆÂ¥0ï¼‰</option>
        <option value="1100">ç‰¹åˆ¥æŒ‡åæ–™ï¼ˆÂ¥1,100ï¼‰</option>
        <option value="2200">ç‰¹åˆ¥æŒ‡åæ–™ï¼ˆÂ¥2,200ï¼‰</option>
      </select>
    </div>
  </div>

  <div style="margin-top:12px">
    <label>å…¥å­¦é‡‘</label>
    <select id="nyugaku">
      <option value="1100">å­¦åœ’ã®ç™»æ ¡ãŒåˆã‚ã¦ã®æ–¹ï¼ˆå…¥å­¦é‡‘Â¥1,100ï¼‰</option>
      <option value="0">å­¦åœ’ã®ç™»æ ¡ã‚’ã—ãŸã“ã¨ãŒã‚ã‚‹æ–¹ï¼ˆÂ¥0ï¼‰</option>
    </select>
  </div>
</div>
      
    
          <div class="card">
        <div class="section-title">3.ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</div>
        <div style="margin-top:12px">
          <div id="options"></div>
          <div class="hint" style="margin-top:8px">â€» ã‚­ãƒ£ã‚¹ãƒˆã«ã‚ˆã£ã¦å¯¾å¿œã§ããªã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚ã‚ã‚Šã¾ã™</div>
          <div class="hint" style="margin-top:8px">â€» â˜…ã®ã¤ã„ã¦ã„ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯äº‹å‰äºˆç´„å¿…é ˆã¨ãªã‚Šã¾ã™ã®ã§ã€ã”äºˆç´„ã®éš›ã«å¿…ãšãŠç”³ã—ä»˜ã‘ãã ã•ã„</div>
        <div class="hint" style="margin-top:8px">â€» ã”è‡ªåˆ†ã®ãŠã‚‚ã¡ã‚ƒã®æŒã¡è¾¼ã¿ã‚‚1ç‚¹æ¯ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ–™é‡‘ã¯ç™ºç”Ÿã—ã¾ã™</div>
        </div>
      </div>
        

    <div class="card">
      <div class="section-title">4. å‰²å¼•ï¼ˆã„ãšã‚Œã‹1ã¤é¸æŠï¼‰</div>
      <div id="discounts" class="wrap"></div>
      <div class="hint" style="margin-top:8px">â€» å‰²å¼•ã¯ä½µç”¨ä¸å¯ã§ã™ã€‚æ¡ä»¶ã«åˆã‚ãªã„å ´åˆã¯è‡ªå‹•çš„ã«é©ç”¨å¤–ã¨ãªã‚Šã¾ã™ã€‚</div>
    </div>

    <div class="card">
      <div class="section-title">5. åŸºæœ¬ãƒ—ãƒ¬ã‚¤</div>
      <div id="plays" class="plays"></div>
    </div>

    <div class="card">
      <div class="section-title">ãŠè¦‹ç©ã‚Šå†…è¨³</div>
      <div id="breakdown" class="list"></div>
    </div>
  </div>

<script>
const CONFIG = {
  courses: {
    basic: [
      { id: "30", label: "30åˆ†", price: 5500 },
      { id: "45", label: "45åˆ†", price: 7700 },
      { id: "60", label: "60åˆ†", price: 9900 },
      { id: "75", label: "75åˆ†", price: 13200 },
      { id: "90", label: "90åˆ†", price: 16500 },
      { id: "105", label: "105åˆ†", price: 19800 },
      { id: "120", label: "120åˆ†", price: 23100 },
    ],
    duo: [
      { id: "30", label: "30åˆ†", price: 11000 },
      { id: "45", label: "45åˆ†", price: 15400 },
      { id: "60", label: "60åˆ†", price: 19800 },
      { id: "75", label: "75åˆ†", price: 26400 },
      { id: "90", label: "90åˆ†", price: 33000 },
      { id: "105", label: "105åˆ†", price: 39600 },
      { id: "120", label: "120åˆ†", price: 46200 },
    ],
  },
  shimeiFees: {
    none: 0,
    shimei: 1100,
    honshimei: 2200,
  },
};

// å‰²å¼•ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆä½µç”¨ä¸å¯ï¼é¸æŠå¼ï¼‰
const DISCOUNTS = [
  {
    id: "none",
    label: "å‰²å¼•ãªã—",
    note: "",
    apply: (ctx) => ({ shimeiOff: 0, nyugakuOff: 0, optionsOff: 0, ineligible: false, reason: "" }),
  },
  {
    id: "newcomer_nomination_1100off",
    label: "æ–°äººæŒ‡åæ–™1,100å††OFFï¼ˆå…¥å­¦ã‹ã‚‰1ãƒ¶æœˆä»¥å†…ã®å¥³å­ç”Ÿå¾’ãƒ»æ•™å¸«é™å®šï¼‰",
    note: "â€» æœ¬æŒ‡åã¯é©ç”¨ä¸å¯ â€» æŒ‡åæ–™1,100å††ç„¡æ–™",
    apply: (ctx) => {
      const isHon = ctx.shimeiKey === "honshimei";
      if (isHon || ctx.shimeiKey === "none") {
        return { shimeiOff: 0, nyugakuOff: 0, optionsOff: 0, ineligible: true, reason: isHon ? "æœ¬æŒ‡åã¯å¯¾è±¡å¤–ã§ã™" : "æŒ‡åãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“" };
      }
      return { shimeiOff: Math.min(1100, ctx.shimeiFee), nyugakuOff: 0, optionsOff: 0, ineligible: false, reason: "" };
    },
  },
  {
    id: "first_time_student_2200off",
    label: "å½“å­¦åœ’ã®ç™»æ ¡ãŒåˆã‚ã¦ã®ç”·å­ç”Ÿå¾’ 2,200å††OFF",
    note: "â€» å£ã‚³ãƒŸæŠ•ç¨¿å¿…é ˆã€‚â€» æŒ‡åæ–™1,100å††ç„¡æ–™ï¼‹å…¥å­¦é‡‘1,100å††ç„¡æ–™",
    apply: (ctx) => {
      const shimeiOff = Math.min(1100, ctx.shimeiFee);
      const nyugakuOff = Math.min(1100, ctx.nyugakuFee);
      if (shimeiOff === 0 && nyugakuOff === 0) {
        // still eligible even if both are zero? We'll allow 0 effect
      }
      return { shimeiOff, nyugakuOff, optionsOff: 0, ineligible: false, reason: "" };
    },
  },
  {
    id: "first_day_cast_3300off",
    label: "å…¥å­¦åˆæ—¥ 3,300å††OFFï¼ˆå…¥å­¦åˆæ—¥ã®å¥³å­ç”Ÿå¾’ãƒ»æ•™å¸«é™å®šï¼‰",
    note: "â€» å£ã‚³ãƒŸï¼‹DiscordåŠ å…¥å¿…é ˆã€‚â€» æŒ‡åæ–™1,100å††ç„¡æ–™ï¼‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³2,200å††åˆ†ç„¡æ–™",
    apply: (ctx) => {
      const shimeiOff = Math.min(1100, ctx.shimeiFee);
      // optionsOff up to 2200 against options total
      const optionsOff = Math.min(2200, ctx.optionsTotal);
      return { shimeiOff, nyugakuOff: 0, optionsOff, ineligible: false, reason: "" };
    },
  },
];

// ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒªã‚¹ãƒˆï¼ˆå¿…è¦ãªã‚‚ã®ã ã‘ï¼‰
const OPTION_LIST = [

    // ã‚»ãƒƒãƒˆï¼ˆisSet: true ï¼‹ savings: 1100ï¼‰
  { id: "opt1", label: "å›ã®è¨˜æ†¶ã‚’æŒã¡å¸°ã‚Šã‚»ãƒƒãƒˆ", price: 2200, isSet: true, savings: 1100,
    note: "å”¾ãŸã‚‰ã—ãƒ»åŒ‚ã„å—…ããƒ»ãƒ‘ãƒ³ãƒ„æŒã¡å¸°ã‚Šãƒ»å”¾æŒã¡å¸°ã‚ŠãŒå«ã¾ã‚Œã¾ã™" },
  { id: "opt2", label: "é’æ˜¥ã®ä¸‰å¤§ã‚¿ãƒ–ãƒ¼ã‚»ãƒƒãƒˆ", price: 3300, isSet: true, savings: 1100,
    note: "è¶³ãªã§ãƒ»ãƒã‚¹ãƒˆã‚¿ãƒƒãƒãƒ»ãŠå°»ã•ã‚ã‚ŠãŒå«ã¾ã‚Œã¾ã™" },
  { id: "opt3", label: "æ”¾èª²å¾Œã®ã‚¤ã‚¿ã‚ºãƒ©ã‚»ãƒƒãƒˆ", price: 3300, isSet: true, savings: 1100,
    note: "ã‚¢ãƒŠãƒ«ãŠã‚‚ã¡ã‚ƒãƒ»ãƒšãƒ‹ãƒãƒ³ãƒ»æŒ‡ã‚¢ãƒŠãƒ«ãŒå«ã¾ã‚Œã¾ã™" },

  // 550å††
  { id: "opt4", label: "ãƒ“ãƒ³ã‚¿", price: 550 },
  { id: "opt5", label: "è¹´ã‚Š", price: 550 },
  { id: "opt6", label: "ç›®éš ã—", price: 550 },
  { id: "opt7", label: "åŒ‚ã„å—…ã", price: 550 },
  { id: "opt8", label: "è¸ã¿ã¤ã‘", price: 550 },
  { id: "opt9", label: "è¶³ã‚³ã‚­", price: 550 },
  { id: "opt10", label: "æ‹˜æŸãƒ†ãƒ¼ãƒ—", price: 550 },
  { id: "opt11", label: "å”¾ãŸã‚‰ã—", price: 550 },
  { id: "opt12", label: "ãã™ãã‚Š", price: 550 },
  { id: "opt13", label: "æ‰‹æ·ï¼‹è¶³æ·", price: 550 },
  { id: "opt14", label: "ä¹³é¦–ãƒ­ãƒ¼ã‚¿ãƒ¼", price: 550 },
  { id: "opt15", label: "ä¹³é¦–ã‚¯ãƒªãƒƒãƒ—", price: 550 },
  { id: "opt16", label: "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ—ãƒ¬ã‚¤", price: 550 },

  // 1100å††
  { id: "opt17", label: "ä¸ŠåŠèº«ãƒ–ãƒ©", price: 1100 },
  { id: "opt18", label: "ä¸‹åŠèº«ãƒ‘ãƒ³ãƒ„", price: 1100 },
  { id: "opt19", label: "ã‚¹ãƒˆãƒƒã‚­ãƒ³ã‚°ç€ç”¨(æŒã¡å¸°ã‚ŠOK)", price: 1100 },
  { id: "opt20", label: "â˜…ã‚³ã‚¹ãƒ—ãƒ¬(1ç€)", price: 1100 },
  { id: "opt21", label: "ãƒãƒ¼ãƒ–ãƒ©", price: 1100 },
  { id: "opt22", label: "ãŠå°»ã•ã‚ã‚Š", price: 1100 },
  { id: "opt23", label: "æŠ±ãã¤ã", price: 1100 },
  { id: "opt24", label: "ç”·ã®æ½®å¹ã", price: 1100 },
  { id: "opt25", label: "äº€é ­è²¬ã‚ï¼ˆã‚¬ãƒ¼ã‚¼orã‚¹ãƒˆãƒƒã‚­ãƒ³ã‚°orãã®ã¾ã¾ï¼‰", price: 1100 },
  { id: "opt26", label: "æŒ‡ã‚¢ãƒŠãƒ«", price: 1100 },
  { id: "opt27", label: "â˜…å‰ƒæ¯›", price: 1100 },
  { id: "opt28", label: "â˜…ãƒãƒƒã‚µãƒ¼ã‚¸", price: 1100 },
  { id: "opt29", label: "ãŠã£ã±ã„é¡”é¢é¨ä¹—", price: 1100 },
  { id: "opt30", label: "è€³èˆã‚", price: 1100 },
  { id: "opt31", label: "å’€åš¼(é£Ÿå“ã¯ã”æŒå‚ãã ã•ã„)", price: 1100 },
  { id: "opt32", label: "ãƒ‘ãƒ³ãƒ„æŒã¡å¸°ã‚Š", price: 1100 },
  { id: "opt33", label: "å”¾æŒã¡å¸°ã‚Š(å®¹å™¨ä»˜ã)", price: 1100 },
  { id: "opt34", label: "ã‚¢ãƒŠãƒ«ãŠã‚‚ã¡ã‚ƒï¼ˆã‚¢ãƒŠãƒ«ãƒ­ãƒ¼ã‚¿ãƒ¼ã€ãƒ‘ãƒ¼ãƒ«ã€ãƒ‡ã‚£ãƒ«ãƒ‰ï¼‰", price: 1100 },
  { id: "opt35", label: "è¶³ãªã§", price: 1100 },

  // 2200å††
  { id: "opt36", label: "é¡”é¢é¨ä¹—", price: 2200 },
  { id: "opt37", label: "ã‚ªãƒ¼ãƒ«ãƒ©ãƒ³ã‚¸ã‚§ãƒªãƒ¼", price: 2200 },
  { id: "opt38", label: "ãƒšãƒ‹ãƒãƒ³", price: 2200 },
  { id: "opt39", label: "ãƒãƒ¼ãƒ‘ãƒ³", price: 2200 },
  { id: "opt40", label: "ãƒã‚¹ãƒˆã‚¿ãƒƒãƒ", price: 2200 },
  { id: "opt41", label: "ãƒˆãƒƒãƒ—ãƒ¬ã‚¹", price: 2200 },
  { id: "opt42", label: "è–æ°´", price: 2200 },
  { id: "opt43", label: "ä¸ŠåŠèº«ãƒªãƒƒãƒ—", price: 2200 },
  { id: "opt44", label: "é¡”èˆã‚(ç”·æ€§ã¸ã®)", price: 2200 },
  { id: "opt45", label: "æµ£è…¸(ç”·å­ç”Ÿå¾’ã®)", price: 2200 },
  { id: "opt46", label: "ã‚¢ãƒŠãƒ«ãƒ•ã‚£ã‚¹ãƒˆ", price: 2200 },
  { id: "opt47", label: "â˜…æ··æµ´(é€šå¸¸æ°´ç€)", price: 2200 },
  { id: "opt48", label: "è¶³èˆã‚ï¼ˆå¥³æ€§ã¸ã®ï¼‰", price: 2200 },
  { id: "opt49", label: "â˜…ç”·æ€§ç”¨ã‚³ã‚¹ãƒ—ãƒ¬(L,XL)", price: 2200 },

  // 3300å††
  { id: "opt50", label: "ã‚ªãƒ¼ãƒ«ãƒŒãƒ¼ãƒ‰", price: 3300 },
];


// åŸºæœ¬ãƒ—ãƒ¬ã‚¤ï¼ˆç·¨é›†OKï¼‰
const BASIC_PLAYS = [
  "ç”·å­ç”Ÿå¾’ã®ã‚ªãƒŠãƒ‹ãƒ¼é‘‘è³",
  "åˆ¶æœã§æ‰‹ã‚³ã‚­",
  "æ™‚é–“å†…ç„¡åˆ¶é™ç™ºå°„",
  "ä¹³é¦–èˆã‚",
  "ä¹³é¦–è²¬ã‚",
  "ç„¦ã‚‰ã—",
];

function yen(n){ n = Math.max(0, Math.round(n) || 0); return "Â¥" + n.toLocaleString("ja-JP"); }
function clamp(n,min,max){ return Math.min(Math.max(n,min),max); }

const els = {
  classTypeWrap: document.getElementById("classTypeWrap"),
  course: document.getElementById("course"),
  options: document.getElementById("options"),
  shimei: document.getElementById("shimei"),
  nyugaku: document.getElementById("nyugaku"),
  discounts: document.getElementById("discounts"),
  plays: document.getElementById("plays"),
  breakdown: document.getElementById("breakdown"),
  total: document.getElementById("total"),
  tokubetsu: document.getElementById("tokubetsu"), 
};

const state = {
  classType: "basic",
  optionState: {}, // id -> bool
  discountId: "none",
};

function rebuildCourseOptions(){
  els.course.innerHTML = "";
  CONFIG.courses[state.classType].forEach(c=>{
    const o = document.createElement("option");
    o.value = c.id; o.textContent = `${c.label}ï¼ˆ${yen(c.price)}ï¼‰`;
    els.course.appendChild(o);
  });
  els.course.value = "60";
}

function rebuildOptionCheckboxes(){
  els.options.innerHTML = "";

  // â‘  ã‚»ãƒƒãƒˆãŒ1ã¤ã§ã‚‚ã‚ã‚Œã°ã€å…±é€šãƒãƒŠãƒ¼ã‚’ä¸Šã«å‡ºã™
  const hasSet = OPTION_LIST.some(o => o.isSet && o.savings);
  if (hasSet){
    const banner = document.createElement("div");
    banner.className = "options-banner";
    banner.innerHTML = `ğŸ“£ ã‚»ãƒƒãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ <strong>å˜å“åˆè¨ˆã‚ˆã‚ŠÂ¥1,100ãŠå¾—ï¼</strong>`;
    els.options.appendChild(banner);
  }

  // â‘¡ å„è¡Œã®å³è‚©ã«ã€Œ-Â¥1,100 ãŠå¾—ã€ãƒãƒƒã‚¸ï¼ˆã‚»ãƒƒãƒˆã®ã¿ï¼‰
  OPTION_LIST.forEach(o=>{
    const row = document.createElement("div");
    row.className = "option";

    const left = document.createElement("div");
    left.innerHTML = `
      <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap">
  <span>${o.label}</span>
  ${o.isSet ? `<span class="save-badge">-Â¥${(o.savings||0).toLocaleString("ja-JP")} ãŠå¾—</span>` : ""}
</div>
      <div class="hint">${yen(o.price)}</div>
      ${o.note ? `<div class="hint" style="margin-top:2px">${o.note}</div>` : ""}
    `;

    const right = document.createElement("div");
    const input = document.createElement("input");
    input.type = "checkbox";
    input.addEventListener("change", ()=>{ state.optionState[o.id] = input.checked; render(); });
    right.appendChild(input);

    row.appendChild(left);
    row.appendChild(right);
    els.options.appendChild(row);

    state.optionState[o.id] = !!state.optionState[o.id]; // æ—¢å­˜é¸æŠã‚’ç¶­æŒ
  });
}

function buildDiscountRadios(){
  els.discounts.innerHTML = "";
  DISCOUNTS.forEach(d=>{
    const label = document.createElement("label");
    label.className = "tag";
    const input = document.createElement("input");
    input.type = "radio"; input.name = "disc"; input.value = d.id;
    if (d.id === state.discountId) input.checked = true;
    input.addEventListener("change", ()=>{ state.discountId = d.id; render(); });
    const text = document.createElement("span");
    text.innerHTML = `<strong>${d.label}</strong><br><span class="hint">${d.note}</span>`;
    label.appendChild(input); label.appendChild(text);
    els.discounts.appendChild(label);
  });
}

function buildPlays(){
  els.plays.innerHTML = "";
  BASIC_PLAYS.forEach(p=>{
    const span = document.createElement("span");
    span.className = "play"; span.textContent = p;
    els.plays.appendChild(span);
  });
}

function init(){
  els.classTypeWrap.querySelectorAll('input[name="ctype"]').forEach(r=>{
    r.addEventListener("change",(e)=>{
      state.classType = e.target.value;
      rebuildCourseOptions();
      render();
    });
  });

  rebuildCourseOptions();
  rebuildOptionCheckboxes();
  buildDiscountRadios();
  buildPlays();

[els.course, els.shimei, els.nyugaku, els.tokubetsu]
  .forEach(el => el.addEventListener("input", render));


  render();
}

function render(){
  const courseList = CONFIG.courses[state.classType];
  const course = courseList.find(c=>c.id === els.course.value) || courseList[2];

  const shimeiKey = els.shimei.value;
  const shimeiFee = CONFIG.shimeiFees[shimeiKey] || 0;

  const nyugakuFee = Math.max(0, Number(els.nyugaku.value)||0);
  const tokubetsuFee = Math.max(0, Number(els.tokubetsu.value)||0);


  let optionsTotal = 0;
  OPTION_LIST.forEach(o=>{ optionsTotal += state.optionState[o.id] ? o.price : 0; });

  // discount apply
  const ctx = { shimeiKey, shimeiFee, nyugakuFee, optionsTotal };
  const disc = DISCOUNTS.find(d=>d.id===state.discountId) || DISCOUNTS[0];
  const res = disc.apply(ctx);

  const shimeiAfter = Math.max(0, shimeiFee - (res.shimeiOff || 0));
  // options discount applies up to optionsTotal
  const optionsAfter = Math.max(0, optionsTotal - (res.optionsOff || 0));
  const nyugakuAfter = Math.max(0, nyugakuFee - (res.nyugakuOff || 0));

const subtotal = (course.price||0) + shimeiAfter + nyugakuAfter + optionsAfter + tokubetsuFee;


  // breakdown
  const lines = [];
  lines.push(line(`æˆæ¥­ã‚¿ã‚¤ãƒ—`, state.classType==="basic" ? "åŸºæœ¬æˆæ¥­ï¼ˆ1äººï¼‰" : "åˆåŒæˆæ¥­ï¼ˆ3Pï¼‰"));
  lines.push(line(`${course.label} æˆæ¥­æ–™`, course.price, false, true));

  if (nyugakuFee>0) {
    const d = nyugakuFee - nyugakuAfter;
    lines.push(line("å…¥å­¦é‡‘", nyugakuAfter));
    if (d>0) lines.push(discountLine("å…¥å­¦é‡‘å‰²å¼•", d));
  }

  if (shimeiKey!=="none"){
    const d = shimeiFee - shimeiAfter;
    lines.push(line("æŒ‡åæ–™", shimeiAfter));
    if (d>0) lines.push(discountLine("æŒ‡åæ–™å‰²å¼•", d));
  }

  if (tokubetsuFee > 0) {
  lines.push(line("ç‰¹åˆ¥æŒ‡åæ–™", tokubetsuFee));
}

  // options
  OPTION_LIST.forEach(o=>{
    if (state.optionState[o.id]) lines.push(line(o.label, o.price));
  });
  const optDiscount = optionsTotal - optionsAfter;
  if (optDiscount>0) lines.push(discountLine("ã‚ªãƒ—ã‚·ãƒ§ãƒ³å‰²å¼•", optDiscount));

  // discount note / eligibility
  if (disc.id !== "none"){
    if (res.ineligible){
      lines.push(`<div class="line muted"><span>â€» é¸æŠã•ã‚ŒãŸå‰²å¼•</span><span>${disc.label}ï¼ˆé©ç”¨å¤–ï¼š${res.reason}ï¼‰</span></div>`);
    } else {
      lines.push(`<div class="line"><span>é©ç”¨å‰²å¼•</span><span>${disc.label}</span></div>`);
    }
  }

  lines.push(`<div class="hr"></div>`);

  els.breakdown.innerHTML = lines.join("");
document.getElementById("fixedTotal").textContent  = yen(subtotal);

  function line(label, value, muted, bold){
    if (typeof value === "string") {
      return `<div class="line ${muted? 'muted':''} ${bold?'':' '}"><span>${label}</span><span>${value}</span></div>`;
    }
    const val = yen(Math.max(0, Math.round(value)));
    return `<div class="line ${muted? 'muted':''} ${bold?'':' '}"><span>${label}</span><span>${val}</span></div>`;
  }
  function discountLine(label, value){
    return `<div class="line muted"><span>${label}</span><span>- ${yen(value)}</span></div>`;
  }
}

init();
</script>

<!-- ãƒšãƒ¼ã‚¸ã®æœ€å¾Œï¼ˆ</body> ã®ç›´å‰ã‚ãŸã‚Šï¼‰ã«è¿½åŠ  -->
<div id="totalBar">
  <div id="fixedTotal">Â¥0</div>
  <div id="fixedNote">â€» è¡¨ç¤ºé‡‘é¡ã¯ç›®å®‰ã§ã™ã€‚å®Ÿéš›ã®ãŠä¼šè¨ˆã¯å½“æ—¥ã®ã”æ¡ˆå†…ã«æº–ã˜ã¾ã™ã€‚</div>
</div>


</body>
</html>